'use strict';

var cac = require('cac');
var a = require('picocolors');
var Q = require('figlet');
var u = require('inquirer');
var f = require('log-symbols');
var D = require('gradient-string');
var U = require('progress-estimator');
var q = require('ora');
var G = require('boxen');
var K = require('simple-git');
var L = require('semver');
var M = require('axios');
var z = require('path');
var w = require('fs-extra');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var a__default = /*#__PURE__*/_interopDefault(a);
var Q__default = /*#__PURE__*/_interopDefault(Q);
var u__default = /*#__PURE__*/_interopDefault(u);
var f__default = /*#__PURE__*/_interopDefault(f);
var D__default = /*#__PURE__*/_interopDefault(D);
var U__default = /*#__PURE__*/_interopDefault(U);
var q__default = /*#__PURE__*/_interopDefault(q);
var G__default = /*#__PURE__*/_interopDefault(G);
var K__default = /*#__PURE__*/_interopDefault(K);
var L__default = /*#__PURE__*/_interopDefault(L);
var M__default = /*#__PURE__*/_interopDefault(M);
var z__default = /*#__PURE__*/_interopDefault(z);
var w__default = /*#__PURE__*/_interopDefault(w);

var v=async()=>{let{template:t}=await u__default.default.prompt([{name:"template",type:"list",message:"\u8BF7\u9009\u62E9\u6A21\u677F\u7C7B\u578B",choices:[{name:"thin",checked:!0},{name:"i18n"},{name:"tauri"},{name:"electron"},{name:"admin"}]}]);return t},T=async()=>{let{projectName:t}=await u__default.default.prompt([{name:"projectName",type:"input",message:"\u8BF7\u8F93\u5165\u9879\u76EE\u540D\u79F0"}]);return t},O=async()=>{let{isOverwrite:t}=await u__default.default.prompt([{name:"isOverwrite",type:"list",message:"\u76EE\u6807\u6587\u4EF6\u5DF2\u5B58\u5728, \u8BF7\u9009\u62E9\u4E00\u4E2A\u64CD\u4F5C",choices:[{name:"\u8986\u76D6",value:!0},{name:"\u53D6\u6D88",value:!1}]}]);return t};var n=console.log,p={err:t=>{n(f__default.default.error,a__default.default.red(t));},warning:t=>{n(f__default.default.warning,a__default.default.yellow(t));},info:t=>{n(f__default.default.info,a__default.default.bold(t));}};var y="pure-thin-cli",c="0.1.8";var E={npm:"https://registry.npmjs.org/",taobao:"https://registry.npmmirror.com/"},s={thin:{downloadUrl:"https://gitee.com/yiming_chang/pure-admin-thin.git",description:"vue-pure-admin\u7CBE\u7B80\u7248",branch:"main"},i18n:{downloadUrl:"https://gitee.com/yiming_chang/pure-admin-thin.git",description:"vue-pure-admin\u7CBE\u7B80\u7248\u56FD\u9645\u5316",branch:"i18n"},tauri:{downloadUrl:"https://gitee.com/yiming_chang/tauri-pure-admin.git",description:"vue-pure-admin\u7CBE\u7B80\u7248\u7684tauri\u6A21\u677F",branch:"main"},electron:{downloadUrl:"https://gitee.com/yiming_chang/electron-pure-admin.git",description:"vue-pure-admin\u7CBE\u7B80\u7248\u7684electron\u6A21\u677F",branch:"master"},admin:{downloadUrl:"https://gitee.com/yiming_chang/vue-pure-admin.git",description:"vue-pure-admin\u5B8C\u6574\u7248",branch:"main"}};var P=U__default.default({spinner:{interval:140,frames:["\u{1F6B6} ","\u{1F3C3} "]}}),S={spinner:"runner"},_=q__default.default(S),A={baseDir:process.cwd(),binary:"git",maxConcurrentProcesses:6},k=async(t,e,i,r)=>{let o=K__default.default(A);try{n(`\u9879\u76EE\u4E0B\u8F7D\u81EA ${a__default.default.cyan(t)}`),await P(o.clone(t,e,i),"\u4E0B\u8F7D\u8017\u65F6: ",{estimate:7e3});}catch{_.fail(),p.err("\u8BF7\u6C42\u5931\u8D25, \u8BF7\u91CD\u8BD5");}let g=D__default.default("cyan","magenta").multiline("Hello! \u6B22\u8FCE\u4F7F\u7528PURE-ADMIN\u811A\u624B\u67B6~ \u{1F970}");if(n(G__default.default(g,{padding:1,margin:1,borderColor:"cyan",borderStyle:"round"})),n(`\r
 \u{1F389} \u5DF2\u6210\u529F\u521B\u5EFA\u9879\u76EE ${a__default.default.cyan(e)}`),n(` \u{1F449} \u5F00\u59CB\u4F7F\u7528\u4EE5\u4E0B\u547D\u4EE4: \r
`),n(` cd ${a__default.default.cyan(e)}`),n(` pnpm install \r
`),r==="tauri")return n(` pnpm tauri:dev \r
`);n(` pnpm dev \r
`);},j=t=>{let e=Reflect.ownKeys(s),i=e.includes(t);return i||(p.err(`\u5F53\u524D\u6A21\u677F\u7C7B\u578B ${a__default.default.cyan(`${t}`)} \u4E0D\u5B58\u5728 \r
 `),p.info("\u8BF7\u8F93\u5165\u4EE5\u4E0B\u5176\u4E2D\u4E00\u79CD\u6A21\u677F\u7C7B\u578B: "),e.forEach(r=>{n(a__default.default.bold(a__default.default.green(`${r} `)+a__default.default.gray(`${s[r].description}`)));})),i};var N=(t="taobao")=>E[t],F=async(t,e=N())=>{let i=e+t,r;try{r=await M__default.default.get(i);}catch(o){p.err(o);}return r},V=async(t,e=N())=>{let{data:i}=await F(t,e);return i["dist-tags"].latest},I=async(t,e)=>{let i=await V(e);if(L__default.default.lt(i,t)||i===t)return;let r=a__default.default.dim,o=a__default.default.magenta;n(G__default.default(`  \u{1F600} ${a__default.default.yellow("\u54C7~\u6709\u66F4\u65B0!")} ${a__default.default.red(t)} \u2192 ${a__default.default.green(i)}.
  \u{1F4AF} ${o("\u66F4\u65B0\u65E5\u5FD7: ")+r(`https://github.com/Ten-K/${e}/releases/tag/v${i}`)}
  \u{1F47B} ${r("\u8FD0\u884C")+o(` npm i -g ${e} `)+r("\u53EF\u4EE5\u66F4\u65B0\u54E6.")}

  \u{1F495} ${r("\u5173\u6CE8")+o(" pure-thin-cli")+r(`\u4E86\u89E3\u6700\u65B0\u52A8\u6001: https://github.com/Ten-K/${e}`)}`,{padding:1,margin:1,borderColor:"cyan",borderStyle:"round"}));};var h=async(t,e)=>{let i=async r=>{let{downloadUrl:o,branch:g}=s[r];await k(o,t,["-b",`${g}`],r),await I(c,y);};if(e)i(e);else {let r=await v();i(r);}};var x=q__default.default(),b=async(t,e)=>{let i=process.cwd(),r=z__default.default.join(i,t);if(w__default.default.existsSync(r)){if(e.force)return await w__default.default.remove(r),!1;if(await O()){try{x.start("\u5220\u9664\u4E2D..."),await w__default.default.remove(r),x.succeed(`\u6210\u529F\u5220\u9664 ${a__default.default.gray(t)}`);}catch{x.fail("\u8986\u76D6\u5931\u8D25, \u8BF7\u91CD\u8BD5"),process.exit(1);}return !1}else return n(a__default.default.green("\u53D6\u6D88\u6210\u529F")),!0}else return !1};var m=cac.cac("pure");m.version(c);m.command("create","\u521B\u5EFA\u4E00\u4E2A\u65B0\u9879\u76EE").option("-f, --force","\u5982\u679C\u76EE\u6807\u6587\u4EF6\u5B58\u5728\uFF0C\u5219\u5F3A\u5236\u8986\u76D6").action(async t=>{let e=await T();await b(e,t)||h(e);});m.command("init <template-name> <project-name>","\u521B\u5EFA\u4E00\u4E2A\u65B0\u9879\u76EE").option("-f, --force","\u5982\u679C\u76EE\u6807\u6587\u4EF6\u5B58\u5728\uFF0C\u5219\u5F3A\u5236\u8986\u76D6").action(async(t,e,i)=>{!j(t)||await b(e,i)||await h(e,t);});m.help(()=>{n(`\r
`+Q__default.default.textSync("pure",{font:"3D-ASCII",horizontalLayout:"default",verticalLayout:"default",width:80,whitespaceBreak:!0})),n(`\u8FD0\u884C ${a__default.default.cyan("pure <command> --help")} \u67E5\u770B\u6709\u5173\u547D\u4EE4\u7684\u8BE6\u7EC6\u7528\u6CD5. \r
`);});m.command("list","\u67E5\u770B\u6240\u6709\u6A21\u677F\u7C7B\u578B").action(()=>{Object.keys(s).forEach(t=>{n(`${t} ${s[t].description}`);});});m.parse();
